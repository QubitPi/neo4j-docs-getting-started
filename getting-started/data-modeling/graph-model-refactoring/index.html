<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, minimum-scale=1">
    <meta name="msvalidate.01" content="B5163518CBE4A854B63801277FE5E35C" />
    <meta name="google-site-verification" content="ucqagxjVuq0lJZeLKs0F5AppzK111lNt3IoxU6mzlJE" />
    <meta name="robots" content="index, follow" />
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
    <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />

    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-WK23PSS');</script>
<!-- Hotjar Tracking Code for staging -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3587741,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<!-- End Hotjar Tracking code -->
    <title>Graph model refactoring - Getting Started</title>
    <link rel="prev" href="../modeling-tips/">
    <link rel="next" href="../data-modeling-tools/">
      <meta name="description" content="Building on the Cypher Basics guides, this guide provides a worked example of changing a graph model. Upon finishing this guide, you should be able to evolve your graph model based on changing requirements.">
<link rel="stylesheet" href="https://neo4j.com/wp-content/themes/neo4jweb/assets/neo4j-react-modules-assets/search-preact/chunkless/bundle.css" />
<link rel="stylesheet" href="https://neo4j.com/wp-content/themes/neo4jweb/assets/neo4j-react-modules-assets/search-preact/chunkless/utilities.min.css" />

    <link rel="preload" href="../../../assets/fonts/fontawesome-webfont.woff2?v=4.7.0" as="font">
    <link rel="stylesheet" href="../../../assets/css/site.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">

    <link rel="shortcut icon" href="https://neo4j.com/wp-content/themes/neo4jweb/favicon.ico" />



    <meta property="neo:type" content="Docs">
    <meta property="neo:site" content="Reference Docs">


    <meta property="og:site_name" content="Neo4j Graph Data Platform" />
    <meta property="article:publisher" content="https://www.facebook.com/neo4j.graph.database" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:creator" content="@neo4j" />
    <meta name="twitter:site" content="@neo4j" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Graph model refactoring - Getting Started" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:image" content="https://dist.neo4j.com/wp-content/uploads/20210423062553/neo4j-social-share-21.png" />
    <meta property="og:description" content="Building on the Cypher Basics guides, this guide provides a worked example of changing a graph model. Upon finishing this guide, you should be able to evolve your graph model based on changing requirements." />
    <meta property="og:url" content="https://neo4j.com/docs/getting-started/data-modeling/graph-model-refactoring/" />
    <link rel="shortcut icon" href="https://neo4j.com/wp-content/themes/neo4jweb/favicon.ico" />
  </head>
  <body class="article docs">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WK23PSS"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<script>(function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;"undefined"!==typeof c?a=b[c]=[]:c="mixpanel";a.people=a.people||[];a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d};a.people.toString=function(){return a.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
for(h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);
mixpanel.init("4bfb2414ab973c741b6f067bf06d5575", {batch_requests: true})
mixpanel.track("Page View", {
    pathname: window.location.origin + window.location.pathname,
    search: window.location.search,
    hash: window.location.hash,
    referrer: document.referrer,
})
</script>
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">

      <img class="navbar-logo" src="https://dist.neo4j.com/wp-content/uploads/20210422142941/neo4j-logo-2020.svg" alt="Neo4j Docs" />
      <a href="/docs/" class="navbar-item no-left-padding" aria-label="Docs">
        Docs
      </a>

      </div>

      <button class="navbar-search search-button" data-target="topbar-nav" id="search_open_mobile" aria-label="Open Search">
        <svg width="23px" height="23px" viewBox="0 0 23 23" version="1.1" class="fill-current float-right" id="searchx" role="button" title="Search Website">
          <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round"
            stroke-linejoin="round">
            <g transform="translate(-2.000000, -2.000000)" stroke="#a0aec0" stroke-width="1.5">
              <circle
                transform="translate(11.389364, 11.388564) rotate(-23.025000) translate(-11.389364, -11.388564) "
                cx="11.3893642" cy="11.3885639" r="8.056"></circle>
              <path d="M17.0853333,17.0844444 L23.3333333,23.3333333" ></path>
            </g>
          </g>
        </svg>
      </button>
      <button class="navbar-burger" data-target="topbar-nav" aria-label="Mobile Navigation Button">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
            <div class="navbar-end">


        <div class="navbar-item has-dropdown is-hoverable docs">
          <a class="navbar-link" href="/docs/">Docs</a>
          <div class="navbar-dropdown">
            <div class="navbar-item project">
              <span class="project-name">Neo4j DBMS</span>
              <ul class="project-links">
                <li><a href="/docs/getting-started/current/" class="project-link">Getting Started</a></li>
                <li><a href="/docs/operations-manual/current/" class="project-link">Operations</a></li>
                <li><a href="/docs/migration-guide/current/" class="project-link">Migration and Upgrade</a></li>
                <li><a href="/docs/status-codes/current/" class="project-link">Status Codes</a></li>
                <li><a href="/docs/java-reference/current/" class="project-link">Java Reference</a></li>
                <li><a href="/docs/kerberos-add-on/current/" class="project-link">Kerberos Add-on</a></li>
              </ul>
            </div>

            <div class="navbar-item project">
              <a class="project-name" href="/docs/aura/">Neo4j Aura</a>
              <ul class="project-links">
                <li><a class="project-link" href="/docs/aura">Neo4j Aura</a></li>
                <li><a class="project-link" href="/docs/aura/auradb/">Neo4j AuraDB</a></li>
                <li><a class="project-link" href="/docs/aura/aurads/">Neo4j AuraDS</a></li>
              </ul>
            </div>

            <div class="navbar-item project">
              <span class="project-name">Neo4j Tools</span>
              <ul class="project-links">
                <li><a href="/docs/bloom-user-guide/current/" class="project-link">Neo4j Bloom</a></li>
                <li><a href="/docs/browser-manual/current/" class="project-link">Neo4j Browser</a></li>
                <li><a href="/docs/data-importer/current/" class="project-link">Neo4j Data Importer</a></li>
                <li><a href="/docs/desktop-manual/current/" class="project-link">Neo4j Desktop</a></li>
                <li><a href="/docs/ops-manager/current/" class="project-link">Neo4j Ops Manager</a></li>
              </ul>
            </div>

            <div class="navbar-item project">
              <span class="project-name">Neo4j Graph Data Science</span>
              <ul class="project-links">
                <li><a href="/docs/graph-data-science/current/" class="project-link">Neo4j Graph Data Science Library</a></li>
              </ul>
            </div>

            <div class="navbar-item project">
              <span class="project-name">Cypher Query Language</span>
              <ul class="project-links">
                <li><a href="/docs/cypher-manual/current/" class="project-link">Cypher</a></li>
                <li><a href="/docs/cypher-cheat-sheet/current/" class="project-link">Cypher Cheat Sheet</a></li>
                <li><a href="/docs/apoc/current/" class="project-link">APOC Library</a></li>
              </ul>
            </div>

            <div class="navbar-item project">
              <span class="project-name" href="/docs/drivers-apis">Create applications</span>
              <ul class="project-links">
                <li><a href="/docs/python-manual/current/" class="project-link">Python Driver</a></li>
                <li><a href="/docs/go-manual/current/" class="project-link">Go Driver</a></li>
                <li><a href="/docs/java-manual/current/" class="project-link">Java Driver</a></li>
                <li><a href="/docs/javascript-manual/current/" class="project-link">JavaScript Driver</a></li>
                <li><a href="/docs/dotnet-manual/current/" class="project-link">.Net Driver</a></li>
                <li><a href="/docs/graphql-manual/current/" class="project-link">Neo4j GraphQL Library</a></li>
                <li><a href="/docs/http-api/current/" class="project-link">HTTP API</a></li>
                <li><a href="/docs/ogm-manual/current/" class="project-link">OGM Library</a></li>
                <li><a href="https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#reference" class="project-link">Spring Data Neo4j</a></li>
                <li><a href="/docs/spark/" class="project-link">Neo4j Connector for Apache Spark</a></li>
                <li><a href="/docs/kafka/" class="project-link">Neo4j Connector for Apache Kafka</a></li>
              </ul>
            </div>

          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable labs">
          <a class="navbar-link" href="/labs/">Labs</a>
          <div class="navbar-dropdown">
            <div class="navbar-item project">
              <a class="project-name" href="/labs/arrows/">arrows.app</a>
              <ul class="project-links">
                <li><a href="/labs/arrows/" class="project-link">Details</a></li>
                <li><a href="https://arrows.app" class="project-link">arrows.app</a></li>
              </ul>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="/labs/apoc/">APOC Extended</a>

              <ul class="project-links">
                <li><a href="/labs/apoc/5/" class="project-link">Documentation</a></li>
                <li><a href="/developer/neo4j-apoc/" class="project-link">Developer Guide</a></li>
              </ul>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="/labs/halin/">Halin</a>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="/labs/etl-tool/">ETL Tool</a>
              <ul class="project-links">
                <li><a href="/labs/etl-tool/" class="project-link">Details</a></li>
                <li><a href="/labs/etl-tool/1.5.0/" class="project-link">Documentation</a></li>
              </ul>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="/labs/neo4j-migrations/">Neo4j Migrations</a>
              <ul class="project-links">
                <li><a href="/labs/neo4j-migrations/" class="project-link">Details</a></li>
                <li><a href="/labs/neo4j-migrations/2.0/" class="project-link">Documentation</a></li>
              </ul>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="/labs/liquibase/">Neo4j Plugin For Liquibase</a>
              <ul class="project-links">
                <li><a href="/labs/liquibase/" class="project-link">Details</a></li>
                <li><a href="https://github.com/liquibase/liquibase-neo4j" class="project-link">Documentation</a></li>
              </ul>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="/labs/neosemantics/">Neosemantics</a>
              <ul class="project-links">
                <li><a href="/labs/neosemantics/tutorial/" class="project-link">Getting Started</a></li>
                <li><a href="/labs/neosemantics/4.0/" class="project-link">Documentation</a></li>
              </ul>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="/labs/neo4j-helm/">Neo4j Helm</a>
              <ul class="project-links">
                <li><a href="/labs/neo4j-helm/" class="project-link">Details</a></li>
                <li><a href="/labs/neo4j-helm/1.0.0/" class="project-link">Documentation</a></li>
              </ul>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="/labs/neodash/">NeoDash</a>
              <ul class="project-links">
                <li><a href="/labs/neodash/" class="project-link">Details</a></li>
                <li><a href="/labs/neodash/2.1/" class="project-link">Documentation</a></li>
              </ul>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="/labs/neomodel/">neomodel</a>
              <ul class="project-links">
                <li><a href="/labs/neomodel/" class="project-link">Details</a></li>
                <li><a href="https://neomodel.readthedocs.io/en/latest/" target="_blank" class="project-link">Documentation</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable developer">
          <a class="navbar-link" href="/developer/resources/">Get Help</a>
          <div class="navbar-dropdown">
            <div class="navbar-item project">
              <a class="project-name" href="https://graphacademy.neo4j.com/?ref=docs" target="_blank">GraphAcademy</a>
              <ul class="project-links">
                <li><a class="project-link" href="https://graphacademy.neo4j.com/?ref=docs">Free, Self Paced Training</a></li>
                <li><a class="project-link" href="https://graphacademy.neo4j.com/certification/?ref=docs" target="_blank">Certification</a></li>
              </ul>
            </div>

            <div class="navbar-item project">
              <a class="project-name" href="https://dev.neo4j.com/forum" target="_blank">Community Forum</a>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="https://dev.neo4j.com/chat" target="_blank">Discord Chat</a>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="/developer/kb" target="_blank">Knowledge Base</a>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="https://medium.com/neo4j" target="_blank">Neo4j Developer Blog</a>
            </div>
            <div class="navbar-item project">
              <a class="project-name" href="https://www.youtube.com/neo4j" target="_blank">Neo4j Videos</a>
            </div>
          </div>
        </div>
        <div class="navbar-item is-hoverable getting-started-cta">
          <a class="navbar-link primary" href="https://neo4j.com/cloud/platform/aura-graph-database/?ref=docs-nav-get-started">Get Started Free</a>
        </div>
        <div class="navbar-item">
          <a class="navbar-link search-button" href="#search" id="search_open"><svg width="23px" height="23px" viewBox="0 0 23 23"
              version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
              class="fill-current float-right" id="search" role="button" title="Search Website">
              <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round"
                stroke-linejoin="round">
                <g transform="translate(-2.000000, -2.000000)" stroke="#a0aec0" stroke-width="1.5">
                  <circle
                    transform="translate(11.389364, 11.388564) rotate(-23.025000) translate(-11.389364, -11.388564) "
                    cx="11.3893642" cy="11.3885639" r="8.056"></circle>
                  <path d="M17.0853333,17.0844444 L23.3333333,23.3333333" ></path>
                </g>
              </g>
            </svg><span class="navbar-mobile">Search</span></a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="getting-started" data-version="">
  <aside class="nav">
    <div class="panels">
      <div class="selectors">
        
      </div>
      <div class="nav-panel-menu is-active" data-panel="menu">
    <nav class="nav-menu">
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../">Welcome to Neo4j</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link nav-item-toggle" href="../../get-started-with-neo4j/">Get started with Neo4j</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../get-started-with-neo4j/graph-database/">What is a graph database?</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link nav-item-toggle" href="../">Model your data for Neo4j</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guide-data-modeling/">Graph modeling guidelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../modeling-designs/">Modeling designs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../relational-to-graph-modeling/">Modeling: relational to graph</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../modeling-tips/">Graph modeling tips</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="./">Graph model refactoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-modeling-tools/">Data modeling tools</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link nav-item-toggle" href="../../data-import/">Import your data into Neo4j</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../data-import/csv-import/">Importing CSV data into Neo4j</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../data-import/json-rest-api-import/">Importing JSON data from a REST API into Neo4j</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../data-import/relational-to-graph-import/">Import: RDBMS to graph</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link nav-item-toggle" href="../../cypher-intro/">Query a Neo4j database</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/cypher-sql/">Comparing Cypher with SQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/patterns/">Patterns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/patterns-in-practice/">Patterns in practice</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/results/">Getting the correct results</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/updating/">Updating the data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/large-statements/">Composing large statements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/subqueries/">Subqueries in Cypher</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/schema/">Defining a schema</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/dates-datetimes-durations/">Dates, datetimes, and durations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/procedures-functions/">How to extend Cypher</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/load-csv/">Tutorial: Import data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cypher-intro/resources/">Cypher resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link nav-item-toggle" href="../../languages-guides/">Connect to Neo4j</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link nav-item-toggle" href="../../languages-guides/java/java-intro/">Using Neo4j from Java</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../languages-guides/java/spring-data-neo4j/">Spring Data Neo4j</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../languages-guides/java/quarkus/">Quarkus</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../languages-guides/java/java-frameworks/">Helidon, Micronaut</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../languages-guides/java/neo4j-ogm/">Neo4j - OGM Object Graph Mapper</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../languages-guides/java/java-procedures/">Procedures and Functions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../languages-guides/neo4j-dotnet/">Using Neo4j from .NET</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../languages-guides/neo4j-javascript/">Neo4j from JavaScript</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../languages-guides/neo4j-python/">Using Neo4j from Python</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../languages-guides/neo4j-go/">Using Neo4j from Go</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../languages-guides/integration-tools/integration/">Neo4j Connectors</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../languages-guides/community-drivers/">Community-contributed libraries</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../gds/">Data science with Neo4j</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link nav-item-toggle" href="../../graph-visualization/graph-visualization/">Visualize your data in Neo4j</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../graph-visualization/graph-visualization-tools/">Graph visualization tools</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link nav-item-toggle" href="../../appendix/">Appendix</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link nav-item-toggle" href="../../appendix/graphdb-concepts/">Graph database concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../appendix/graphdb-concepts/graphdb-vs-rdbms/">Transition from relational to graph database</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../appendix/graphdb-concepts/graphdb-vs-nosql/">Transition from NoSQL to graph database</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../appendix/example-data/">Example datasets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../appendix/getting-started-resources/">Getting started resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link nav-item-toggle" href="../../appendix/tutorials/tutorials-overview/">Tutorials</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../appendix/tutorials/guide-cypher-basics/">Tutorial: Getting Started with Cypher</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../appendix/tutorials/guide-build-a-recommendation-engine/">Tutorial: Build a Cypher Recommendation Engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../appendix/tutorials/guide-import-relational-and-etl/">Tutorial: Import data from a relational database into Neo4j</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../appendix/tutorials/guide-import-desktop-csv/">How-To: Import CSV data with Neo4j Desktop</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
  <div class="toolbar-wrapper">
    <button class="nav-toggle" aria-label="Toggle Table of Contents"></button>
    <a href="../../" class="home-link" aria-label="Go to home page"></a>
    <nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../">Getting Started</a></li>
    <li><a href="../">
        Model your data for Neo4j
    </a></li>
    <li><a href="./">
        Graph model refactoring
    </a></li>
  </ul>
</nav>
        <div class="edit-this-page"><a href="https://github.com/neo4j/docs-getting-started/tree/master/modules/ROOT/pages/data-modeling/graph-model-refactoring.adoc">Edit this Page</a></div>
    </div>
</div>

  <div class="content">
<article class="doc">
<div class="sect-header">
<h1 class="page">Graph model refactoring</h1>
</div>





<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Building on the Cypher<sup>&reg;</sup> basic concepts, this guide provides a worked example of changing a graph model.
Upon finishing this guide, you should be able to evolve your graph model based on changing requirements.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="airports-dataset"><a class="anchor" href="#airports-dataset"></a>Airports dataset</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide we&#8217;re going to use an airports dataset that contains connections between US airports in January 2008.
We have the data in a CSV file, and this is the graph model that we&#8217;re going to import it into:</p>
</div>
<div class="imageblock popup-link">
<div class="content">
<img src="../../_images/initial_model-arr.svg" alt="initial model arr" width="600">
</div>
</div>
<div class="paragraph">
<p>Before we import any data, we&#8217;re going to create a unique constraint on the <code>Airport</code> label and <code>code</code> property to ensure that we don&#8217;t accidentally import duplicate airports.
The following query creates this constraint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">CREATE CONSTRAINT airport_id
FOR (airport:Airport) REQUIRE airport.code IS UNIQUE</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Results</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 rows available after 86 ms, consumed after another 0 ms. Added 1 constraints</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>And the following query loads the data from a CSV file using the <code>LOAD CSV</code> tool:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">LOAD CSV WITH HEADERS FROM "https://raw.githubusercontent.com/neo4j-contrib/training/master/modeling/data/flights_1k.csv" AS row
MERGE (origin:Airport {code: row.Origin})
MERGE (destination:Airport {code: row.Dest})
MERGE (origin)-[connection:CONNECTED_TO {
  airline: row.UniqueCarrier,
  flightNumber: row.FlightNum,
  date: date({year: toInteger(row.Year), month: toInteger(row.Month), day: toInteger(row.DayofMonth)}),
  cancelled: row.Cancelled,
  diverted: row.Diverted}]-&gt;(destination)
ON CREATE SET connection.departure = localtime(apoc.text.lpad(row.CRSDepTime, 4, "0")),
              connection.arrival = localtime(apoc.text.lpad(row.CRSArrTime, 4, "0"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates a node with an <code>Airport</code> label with a <code>code</code> property that has a value from the <code>Origin</code> column in the CSV file</p>
</li>
<li>
<p>Creates a node with an <code>Airport</code> label with a <code>code</code> property that has a value from the <code>Dest</code> column in the CSV file</p>
</li>
<li>
<p>Creates a relationship of type <code>CONNECTED_TO</code> with several properties based on columns in the CSV file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If we run this query we&#8217;ll see the following output:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Results</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added 62 labels, created 62 nodes, set 7062 properties, created 1000 relationships, completed after 376 ms.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This model is a good starter one, but there are some improvements that we can make.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="property-to-boolean"><a class="anchor" href="#property-to-boolean"></a>Convert property to boolean</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>diverted</code> and <code>cancelled</code> properties on the <code>CONNECTED_TO</code> relationships contain string values of <code>1</code> and <code>0</code>.
Since these values are representing booleans, we can use the <a href="https://neo4j.com/docs/labs/apoc/current/graph-updates/graph-refactoring/normalize-boolean/" target="_blank" rel="noopener"><code>apoc.refactor.normalizeAsBoolean</code></a> procedure to convert the values from strings to booleans.</p>
</div>
<div class="imageblock popup-link">
<div class="content">
<img src="../../_images/boolean_refactoring-arr.svg" alt="boolean refactoring arr" width="600">
</div>
</div>
<div class="paragraph">
<p>The following query does the conversion for the <code>diverted</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (:Airport)-[connectedTo:CONNECTED_TO]-&gt;(:Airport)
CALL apoc.refactor.normalizeAsBoolean(connectedTo, "diverted", ["1"], ["0"])
RETURN count(*)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Results</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">count(*)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>And the following query does the conversion for the <code>cancelled</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (origin:Airport)-[connectedTo:CONNECTED_TO]-&gt;(departure)
CALL apoc.refactor.normalizeAsBoolean(connectedTo, "cancelled", ["1"], ["0"])
RETURN count(*)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Results</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">count(*)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If we have a lot of relationships to update, we may get an OutOfMemory exception if we try to refactor them all in one transaction.
We can therefore process them in batches using the <a href="https://neo4j.com/docs/labs/apoc/current/graph-updates/periodic-execution/#commit-batching" target="_blank" rel="noopener"><code>apoc.periodic.iterate</code></a> procedure.
The following query does this for the <code>cancelled</code> and <code>reverted</code> properties in the same query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">UNWIND ["cancelled", "reverted"] AS propertyToDelete
CALL apoc.periodic.iterate(
  "MATCH (:Airport)-[connectedTo:CONNECTED_TO]-&gt;(:Airport) RETURN connectedTo",
  "CALL apoc.refactor.normalizeAsBoolean(connectedTo, $propertyToDelete, ['1'], ['0'])
   RETURN count(*)",
  {params: {propertyToDelete: propertyToDelete}, batchSize: 100})
YIELD batches
RETURN propertyToDelete, batches</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>apoc.periodic.iterate</code> procedure in this query takes in three parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An outer Cypher query that finds and returns a stream of <code>CONNECTED_TO</code> relationships to be processed.</p>
</li>
<li>
<p>An inner Cypher query that processes those <code>CONNECTED_TO</code> relationships, converting to boolean any values for the specified property on those relationships. It does this using the <code>apoc.refactor.normalizeAsBoolean</code> procedure, which itself takes in several parameters:</p>
<div class="ulist">
<ul>
<li>
<p>the entity on which the property exists</p>
</li>
<li>
<p>the name of the property to normalize</p>
</li>
<li>
<p>a list of values that should be considered <code>true</code></p>
</li>
<li>
<p>a list of values that should be considered <code>false</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Configuration values for the procedure, including:</p>
<div class="ulist">
<ul>
<li>
<p><code>params</code> - parameters passed into those Cypher queries</p>
</li>
<li>
<p><code>batchSize</code>- controls the number of inner statements that are run within a single transaction</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When we run this query we see the following output:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Results</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">propertyToDelete</th>
<th class="tableblock halign-left valign-top">batches</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"cancelled"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"reverted"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once we&#8217;ve done this, we can write the following query to return all cancelled connections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (origin:Airport)-[connectedTo:CONNECTED_TO]-&gt;(destination)
WHERE connectedTo.cancelled
RETURN origin.code AS origin,
       destination.code AS destination,
       connectedTo.date AS date,
       connectedTo.departure AS departure,
       connectedTo.arrival AS arrival</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Results</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">origin</th>
<th class="tableblock halign-left valign-top">destination</th>
<th class="tableblock halign-left valign-top">date</th>
<th class="tableblock halign-left valign-top">departure</th>
<th class="tableblock halign-left valign-top">arrival</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"LAS"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"OAK"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">07:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">08:30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"LAX"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"SFO"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">09:05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10:25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"LAX"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"OAK"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12:15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"LAX"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"SJC"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19:30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20:35</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"LAX"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"SFO"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16:20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17:40</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"MDW"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"STL"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11:10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12:15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"MDW"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"BDL"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">08:45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11:40</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"MDW"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"DTW"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">06:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">08:05</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"MDW"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"STL"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14:45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15:50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"MDW"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"BNA"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19:25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20:45</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"OAK"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"BUR"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13:10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14:15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"OAK"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"BUR"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2008-01-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17:05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18:10</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="create-node-from-relationship"><a class="anchor" href="#create-node-from-relationship"></a>Create node from relationship</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next, imagine that we want to write a query that finds a specific flight.
This is quite difficult with our existing model because flights are represented as relationships.
We can evolve our model to create a <code>Flight</code> node from the properties stored on the <code>CONNECTED_TO</code> relationship.</p>
</div>
<div class="imageblock popup-link">
<div class="content">
<img src="../../_images/flight_node-arr.svg" alt="flight node arr" width="600">
</div>
</div>
<div class="paragraph">
<p>The following query does this refactoring:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">CALL apoc.periodic.iterate(
  "MATCH (origin:Airport)-[connected:CONNECTED_TO]-&gt;(destination:Airport) RETURN origin, connected, destination",
  "CREATE (flight:Flight {
     date: connected.date,
     airline: connected.airline,
     number: connected.flightNumber,
     departure: connected.departure,
     arrival: connected.arrival,
     cancelled: connected.cancelled,
     diverted: connected.diverted
   })
   MERGE (origin)&lt;-[:ORIGIN]-(flight)
   MERGE (flight)-[:DESTINATION]-&gt;(destination)
   DELETE connected",
  {batchSize: 100})</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with our previous query, this query uses the <code>apoc.periodic.iterate</code> procedure so that we can do the refactoring in batches rather than within a single transaction.
The procedure takes in three parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An outer Cypher query that finds and returns a stream of <code>CONNECTED_TO</code> relationships, and origin and destination airports that need to be processed.</p>
</li>
<li>
<p>An inner Cypher query that processes those entities, creating a node with the label <code>Flight</code> and creating relationships from that node to the origin and destination airports.</p>
</li>
<li>
<p><code>batchSize</code> configuration, which sets to <code>100</code> the number of inner statements that are run within a single transaction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If we execute the query we&#8217;ll see the following output:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Results</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">batches</th>
<th class="tableblock halign-left valign-top">total</th>
<th class="tableblock halign-left valign-top">timeTaken</th>
<th class="tableblock halign-left valign-top">committedOperations</th>
<th class="tableblock halign-left valign-top">failedOperations</th>
<th class="tableblock halign-left valign-top">failedBatches</th>
<th class="tableblock halign-left valign-top">retries</th>
<th class="tableblock halign-left valign-top">errorMessages</th>
<th class="tableblock halign-left valign-top">batch</th>
<th class="tableblock halign-left valign-top">operations</th>
<th class="tableblock halign-left valign-top">wasTerminated</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{total: 10, committed: 10, failed: 0, errors: {}}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{total: 1000, committed: 1000, failed: 0, errors: {}}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We can also do this refactoring using the <a href="https://neo4j.com/docs/labs/apoc/current/graph-updates/graph-refactoring/extract-node-from-relationship/" target="_blank" rel="noopener"><code>apoc.refactor.extractNode</code></a> procedure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">CALL apoc.periodic.iterate(
  "MATCH (origin:Airport)-[connected:CONNECTED_TO]-&gt;(destination:Airport)
   RETURN origin, connected, destination",
  "CALL apoc.refactor.extractNode([connected], ['Flight'], 'DESTINATION', 'ORIGIN')
   YIELD input, output, error
   RETURN input, output, error",
  {batchSize: 100});</code></pre>
</div>
</div>
<div class="paragraph">
<p>This does the same as the previous query, but the outer Cypher query uses the <code>apoc.refactor.extractNode</code> procedure to create the <code>Flight</code> node and create relationships to origin and destination airports.
If we run this query we&#8217;ll see the following output:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Results</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">batches</th>
<th class="tableblock halign-left valign-top">total</th>
<th class="tableblock halign-left valign-top">timeTaken</th>
<th class="tableblock halign-left valign-top">committedOperations</th>
<th class="tableblock halign-left valign-top">failedOperations</th>
<th class="tableblock halign-left valign-top">failedBatches</th>
<th class="tableblock halign-left valign-top">retries</th>
<th class="tableblock halign-left valign-top">errorMessages</th>
<th class="tableblock halign-left valign-top">batch</th>
<th class="tableblock halign-left valign-top">operations</th>
<th class="tableblock halign-left valign-top">wasTerminated</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{total: 10, committed: 10, failed: 0, errors: {}}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{total: 1000, committed: 1000, failed: 0, errors: {}}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="create-node-from-property"><a class="anchor" href="#create-node-from-property"></a>Create node from property</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At the moment the airline for our flights is stored in the <code>airline</code> property on <code>Flight</code> nodes.
This means that if we wanted to return a stream of all airlines we&#8217;d need to scan through every flight and check the <code>airline</code> property on each of those flights.</p>
</div>
<div class="paragraph">
<p>We can make it easier, and more efficient, to write this query by creating a node with an <code>Airline</code> label for each airline:</p>
</div>
<div class="imageblock popup-link">
<div class="content">
<img src="../../_images/airline-arr.svg" alt="airline arr" width="600">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s first create a constraint on the <code>Airline</code> label and <code>name</code> property so that we don&#8217;t create duplicate airline nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">CREATE CONSTRAINT airline_id
FOR (airline:Airline) REQUIRE airline.name IS UNIQUE</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Results</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 rows available after 107 ms, consumed after another 0 ms. Added 1 constraints</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>And now we can execute the following query to do the refactoring:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">CALL apoc.periodic.iterate(
   'MATCH (flight:Flight) RETURN flight',
   'MERGE (airline:Airline {name:flight.airline})
    MERGE (flight)-[:AIRLINE]-&gt;(airline)
    REMOVE flight.airline',
   {batchSize:10000, iterateList:true, parallel:false}
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again we&#8217;re using the <code>apoc.periodic.iterate</code> procedure, with the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An outer Cypher statement that returns a stream of <code>Flight</code> nodes to be processed</p>
</li>
<li>
<p>An inner Cypher statementthat processes these flight nodes, creating <code>Airline</code> nodes based on flights' <code>airline</code> property and created an <code>AIRLINE</code> relationship from the <code>Flight</code> to the <code>Airline</code> node. We then remove the <code>airline</code> property from the <code>Flight</code> node.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If we run this query we&#8217;ll see the following output:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Results</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">batches</th>
<th class="tableblock halign-left valign-top">total</th>
<th class="tableblock halign-left valign-top">timeTaken</th>
<th class="tableblock halign-left valign-top">committedOperations</th>
<th class="tableblock halign-left valign-top">failedOperations</th>
<th class="tableblock halign-left valign-top">failedBatches</th>
<th class="tableblock halign-left valign-top">retries</th>
<th class="tableblock halign-left valign-top">errorMessages</th>
<th class="tableblock halign-left valign-top">batch</th>
<th class="tableblock halign-left valign-top">operations</th>
<th class="tableblock halign-left valign-top">wasTerminated</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{total: 1, committed: 1, failed: 0, errors: {}}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{total: 1000, committed: 1000, failed: 0, errors: {}}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FALSE</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We can then write the following query to find the airlines and number of flights involving each:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (airline:Airline)&lt;-[:AIRLINE]-(:Flight)
RETURN airline.name AS airline, count(*) AS numberOfFlights</code></pre>
</div>
</div>
<div class="paragraph">
<p>This does the same as the previous query, but the outer Cypher query uses the <code>apoc.refactor.extractNode</code> procedure to create the <code>Flight</code> node and create relationships to origin and destination airports.
If we run this query we&#8217;ll see the following output:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Results</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">airline</th>
<th class="tableblock halign-left valign-top">numberOfFlights</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"WN"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="cypher-resources"><a class="anchor" href="#cypher-resources"></a>Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide has shown how to refactor a graph model, with help from procedures in the APOC Library.
Below are some resources for learning more about refactoring in Neo4j:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://neo4j.com/docs/apoc/current/" target="_blank" rel="noopener">APOC Library</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://neo4j.com/docs/apoc/current/graph-refactoring/" target="_blank" rel="noopener">Graph Refactoring procedures</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../modeling-tips/">Graph modeling tips</a></span>

  <span class="next"><a href="../data-modeling-tools/">Data modeling tools</a></span>
</nav>
    <div class="feedback">
    <div class="header question">
        <p><strong>Was this page helpful?</strong></p>

        <svg width="22px" height="22px" viewBox="0 0 22 22" role="button" class="no" aria-label="No, this page isn't helpful">
            <path
                d="M6.25,15.8333333 C6.25,13.7622655 7.92893219,12.0833333 10,12.0833333 C12.0710678,12.0833333 13.75,13.7622655 13.75,15.8333333"
                ></path>
            <circle  cx="10" cy="10" r="9.58333333"></circle>
            <path
                d="M12.5,4.58333333 C12.8934466,4.05873783 13.5109223,3.75 14.1666667,3.75 C14.822411,3.75 15.4398867,4.05873783 15.8333333,4.58333333"
                ></path>
            <line x1="4.58333333" y1="7.91666667" x2="7.08333333" y2="7.91666667" ></line>
            <path
                d="M7.08333333,8.54166667 C6.96827401,8.54166667 6.875,8.44839266 6.875,8.33333333 C6.875,8.21827401 6.96827401,8.125 7.08333333,8.125 C7.19839266,8.125 7.29166667,8.21827401 7.29166667,8.33333333 C7.29166667,8.44839266 7.19839266,8.54166667 7.08333333,8.54166667"
                ></path>
            <line x1="12.9166667" y1="7.91666667" x2="15.4166667" y2="7.91666667" ></line>
            <path
                d="M15.4166667,8.54166667 C15.3016073,8.54166667 15.2083333,8.44839266 15.2083333,8.33333333 C15.2083333,8.21827401 15.3016073,8.125 15.4166667,8.125 C15.531726,8.125 15.625,8.21827401 15.625,8.33333333 C15.625,8.44839266 15.531726,8.54166667 15.4166667,8.54166667"
                ></path>
            <path
                d="M4.16666667,4.58333333 C4.5601133,4.05873783 5.17758895,3.75 5.83333333,3.75 C6.48907772,3.75 7.10655337,4.05873783 7.5,4.58333333"
                ></path>
        </svg>

        <svg width="22px" height="22px" viewBox="0 0 22 22" role="button" class="yes" aria-label="Yes, this page is helpful">
            <circle  cx="10" cy="10" r="9.58333333"></circle>
            <path
                d="M5.41666667,8.125 C5.53172599,8.125 5.625,8.21827401 5.625,8.33333333 C5.625,8.44839266 5.53172599,8.54166667 5.41666667,8.54166667 C5.30160734,8.54166667 5.20833333,8.44839266 5.20833333,8.33333333 C5.20833333,8.21827401 5.30160734,8.125 5.41666667,8.125"
                ></path>
            <path
                d="M14.5833333,8.125 C14.468274,8.125 14.375,8.21827401 14.375,8.33333333 C14.375,8.44839266 14.468274,8.54166667 14.5833333,8.54166667 C14.6983927,8.54166667 14.7916667,8.44839266 14.7916667,8.33333333 C14.7916667,8.21827401 14.6983927,8.125 14.5833333,8.125"
                ></path>
            <path
                d="M13.2275,12.9166657 C13.4853075,12.9162808 13.7287776,13.035241 13.8869095,13.2388563 C14.0450415,13.4424715 14.1000278,13.7078123 14.0358333,13.9575 C13.562901,15.7999679 11.9021969,17.0882321 10,17.0882321 C8.09780311,17.0882321 6.43709903,15.7999679 5.96416667,13.9575 C5.89997223,13.7078123 5.95495852,13.4424715 6.11309045,13.2388563 C6.27122239,13.035241 6.51469246,12.9162808 6.7725,12.9166657 L13.2275,12.9166657 Z"
                ></path>
        </svg>
    </div>


</div></article>
<aside class="toc sidebar" data-title="Contents"
  data-levels="2">
  <div class="toc-menu">
    <div class="toc-menu-placeholder"></div>

      </div>
  </aside>  </div>
</main>
</div>
<footer class="footer">
  <div class="wrapper">
  <div class="column">
    <div class="logo-footer"></div>
    <p>© <span id="footer-copyright-year">2023</span> Neo4j, Inc.<br>
      <a href="https://neo4j.com/terms/">Terms</a> | <a href="https://neo4j.com/privacy-policy/">Privacy </a> | <a href="https://neo4j.com/sitemap/">Sitemap</a></p>
    <p>Neo4j<sup>®</sup>, Neo Technology<sup>®</sup>, Cypher<sup>®</sup>, Neo4j<sup>®</sup> Bloom<sup>™</sup> and
      Neo4j<sup>®</sup> Aura<sup>™</sup> are registered trademarks
      of Neo4j, Inc. All other marks are owned by their respective companies.</p>
  </div>

  <div class="column">
    <h2><a href="https://neo4j.com/contact-us/?ref=footer">Contact Us →</a></h2>
    <p>US: 1-855-636-4532<br>
      Sweden +46 171 480 113<br>
      UK: +44 20 3868 3223<br>
      France: +33 (0) 1 88 46 13 20<br>
      <!--Germany: +49 (0)89 26204 6300</p>-->
    </p>
  </div>
  <div class="column links">
    <h2>Learn</h2>
    <ul>
      <li><i class="fa fa-wrench" aria-hidden="true"></i> <a rel="noopener" href="https://neo4j.com/sandbox/?ref=developer-footer">Sandbox</a></li>
      <li><i class="fa fa-comments-o" aria-hidden="true"></i> <a rel="noopener" href="https://community.neo4j.com?ref=developer-footer" target="_blank">Neo4j Community Site</a></li>
      <li><i class="fa fa-book" aria-hidden="true"></i> <a rel="noopener" href="https://medium.com/neo4j" target="_blank">Neo4j Developer Blog</a></li>
      <li><i class="fa fa-youtube" aria-hidden="true"></i> <a rel="noopener" href="https://www.youtube.com/neo4j" target="_blank">Neo4j Videos</a></li>
      <li><i class="fa fa-graduation-cap" aria-hidden="true"></i> <a rel="noopener" href="https://neo4j.com/graphacademy/?ref=developer-footer">GraphAcademy</a></li>
      <li><i class="fa fa-flask" aria-hidden="true"></i> <a href="https://neo4j.com/labs/?ref=developer-footer">Neo4j Labs</a></li>
    </ul>
  </div>
  <div class="column links">
    <h2>Social</h2>
    <ul>
      <li><i class="fa fa-twitter" aria-hidden="true"></i> <a rel="noopener" href="https://twitter.com/neo4j" target="_blank">Twitter</a></li>
      <li><i class="fa fa-meetup" aria-hidden="true"></i> <a rel="noopener" href="https://www.meetup.com/Neo4j-Online-Meetup/" target="_blank">Meetups</a></li>
      <li><i class="fa fa-github" aria-hidden="true"></i> <a rel="noopener" href="https://github.com/neo4j/neo4j" target="_blank">Github</a></li>
      <li><i class="fa fa-stack-overflow" aria-hidden="true"></i> <a rel="noopener" href="https://stackoverflow.com/questions/tagged/neo4j" target="_blank">Stack Overflow</a></li>

      <li class="speaker-program"><a href="https://docs.google.com/forms/d/e/1FAIpQLSdEcNnMruES5iwvOVYovmS1D_P1ZL_HdUOitFrwrvruv5PZvA/viewform">Want to Speak?</a></li>
    </ul>
  </div>
</div>
</footer>

  <script src="../../../assets/js/vendor/auth0.js"></script>
  <script src="../../../assets/js/site.js"></script>
  <script async src="../../../assets/js/vendor/highlight.js"></script>
  <script async src="../../../assets/js/vendor/image-zoom.js"></script>


<div id="neo4j-algolia-search-v2"></div>
<script src="https://neo4j.com/wp-content/themes/neo4jweb/assets/neo4j-react-modules-assets/search-preact/chunkless/bundle.js"></script>
<script src="https://neo4j.com/wp-content/themes/neo4jweb/assets/neo4j-react-modules-assets/search-preact/chunkless/polyfill.js"></script>
<script>window.algoliaSearchOptions = {indexName: "docs",placeholder: "Search Documentation",template: "docs"}</script>  </body>
</html>
